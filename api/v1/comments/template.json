{% assign lesson = site.data.lessons['terminale'][include.lesson] %}{"lesson": "{{ lesson.id }}", "comments": [{% if site.data.comments != null %}{% assign comments_hashes = site.data.comments | sort | where_exp: 'comment_hash', 'comment_hash[1].level == lesson.level' | where_exp: 'comment_hash', 'comment_hash[1].lesson == lesson.id' %}{% for comment_hash in comments_hashes reversed %}{% assign comment = comment_hash[1] %}{"id": "{{ comment._id }}", "author": {"name": "{{ comment.author | escape }}", "avatar": "{% if site.comments.moderators contains comment.author %}{{ site.comments.moderators[comment.author] }}{% else %}https://api.adorable.io/avatars/128/{{ comment.author }}.png{% endif %}", "isModerator": {% if site.comments.moderators contains comment.author %}true{% else %}false{% endif %}}, "message": "{{ comment.message | escape }}", "date": {{ comment.date }}}{% unless forloop.last %},{% endunless %}{% endfor %}{% endif %}], "postUrl": "https://dev.staticman.net/v3/entry/github/Skyost/Bacomathiques/master/comments"}